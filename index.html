<!doctype html>
<html lang="en">

<head>
	<title>Line Chart</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.7.1/Chart.bundle.min.js"></script>
    
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">

    <script src="https://code.jquery.com/jquery-3.2.1.min.js"></script>

	<script language="JavaScript" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
	<script language="JavaScript" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.js"></script>

	<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>

	<script src="utils.js"></script>
	<script src="analyser.js"></script>
	<style>
	canvas{
		-moz-user-select: none;
		-webkit-user-select: none;
		-ms-user-select: none;
	}
	</style>
</head>

<body>


	<script>
	
	// $.getJSON('https://s3.eu-west-2.amazonaws.com/redwards-tf-test/pcf-demo-lab-usage-from-2018-01-01-to-2018-01-31_1518642497.json', function(data) {

		$.getJSON("data.json", function (data) {

		var numberAI = data.total_app_instance_count;
		var totalMemory = data.total_app_memory_used_in_mb + " MB";
		var totalDisk = data.total_disk_quota_in_mb + " MB";
		
		document.getElementById("numberAI").innerHTML = numberAI;
		// document.getElementById("someInput").innerHTML = xxx;
		document.getElementById("memory").innerHTML = totalMemory;
		document.getElementById("disk").innerHTML = totalDisk;
		
		});


	</script>

	<div class="container">
		<div class="card-deck mb-3 text-center">
			<div class="card mb-4 box-shadow">
				<div class="card-header">
					<h4 class="my-0 font-weight-normal">App Instances</h4>
				</div>
				<div class="card-body">
					<h1 class="card-title pricing-card-title" id="numberAI"></h1>
					<button type="button" class="btn btn-lg btn-block btn-outline-primary">Details</button>
				</div>
			</div>
			<div class="card mb-4 box-shadow">
				<div class="card-header">
					<h4 class="my-0 font-weight-normal">Services</h4>
				</div>
				<div class="card-body">
					<h1 class="card-title pricing-card-title">23</h1>
					<button type="button" class="btn btn-lg btn-block btn-primary">Details</button>
				</div>
			</div>
			<div class="card mb-4 box-shadow">
				<div class="card-header">
					<h4 class="my-0 font-weight-normal">Total Memory</h4>
				</div>
				<div class="card-body">
					<h1 class="card-title pricing-card-title" id="memory"> mb</h1>
					<button type="button" class="btn btn-lg btn-block btn-primary">Details</button>
				</div>
			</div>
			<div class="card mb-4 box-shadow">
				<div class="card-header">
					<h4 class="my-0 font-weight-normal">Total Disk</h4>
				</div>
				<div class="card-body">
					<h1 class="card-title pricing-card-title" id="disk"> mb</h1>
					<button type="button" class="btn btn-lg btn-block btn-primary">Details</button>
				</div>
			</div>
		</div>

		<div class="content">
			<div style="width:100%;">
				<canvas id="chart-0"></canvas>
			</div>
		
			<div id="chart-analyser" class="analyser"></div>
		</div>

		<script>
			
			var buildPacksName = [];
			var buildPacksUsed = [];
			$.getJSON("data.json", function (data) {
			
			for (i in data.buildpack_usages) {
				buildPacksName.push(data.buildpack_usages[i].name);
				buildPacksUsed.push(data.buildpack_usages[i].instances);
			}

			var presets = window.chartColors;
			var utils = Samples.utils;
			var options = {
				maintainAspectRatio: true,
				spanGaps: false,
				elements: {
					line: {
						tension: 0.000001
					}
				}
			};
		

			var radarData = {
				labels: buildPacksName,
				datasets: [{
					backgroundColor: utils.transparentize(presets.blue),
					lineTension: 0.4,
					borderColor: presets.blue,
					data: buildPacksUsed,
					label: "Buildpack Usage"
			}]
			};


			var myRadarChart = new Chart('chart-0', {
				type: 'radar',
				data: radarData,
				options: options
			});
		});

		</script>

<script>
// Hack to get HTML canvas to display correctly on page - this needs to be cleaned up by someone that knows js :-)
	var str = '';
	$.getJSON("data.json", function (json) {
		for (o in json.organizations) {
			var orgName = json.organizations[o].name;
			str += "<div><canvas id=" + orgName + "></canvas></div>";
		}
	document.getElementById('example').innerHTML = str;
	});
</script>

<div style="width:75%;" id="example"></div>

<script>

	$.getJSON("data.json", function (json) {
		for (o in json.organizations) {
			var orgName = json.organizations[o].name;
			var spaceName = [];
			var spaceInstances = [];
			
			for (s in json.organizations[o].spaces){
				spaceName.push(json.organizations[o].spaces[s].name);
				spaceInstances.push(json.organizations[o].spaces[s].total_app_instance_count);
			}

			var color = Chart.helpers.color;

			var options = {
				maintainAspectRatio: true,
				spanGaps: false,
				elements: {
					line: {
						tension: 0.000001
					}
				}
			};
			
			var data = {
				labels: spaceName,
				datasets: [{
					label: orgName,
					backgroundColor: color(window.chartColors.red).alpha(0.5).rgbString(),
					borderColor: window.chartColors.red,
					borderWidth: 1,
					data: spaceInstances
				}]
			};
			
			var canvas = document.getElementById(orgName);
			var ctx = canvas.getContext("2d");
			new Chart(ctx, {
				type: 'horizontalBar',
				data: data,
				options: options
			});		

		};
	});
</script>

</body>

</html>
